{% extends "index.html" %}
{% load static %}
{% block content %}
<main>
    <h1 class="page-title">Il Mio Account</h1>
    <div class="container_profilo">
        <div class="barra">
            <div class="info-user">
                <img src="https://thumbs.dreamstime.com/b/icona-utente-social-media-vettoriale-immagine-profilo-avatar-predefinita-potrait-182347582.jpg" alt="Avatar" class="avatar">
                <div>
                    <h2 class="user-name">{{ utente.nome }} {{ utente.cognome }}</h2>
                    <p class="user-email">{{ utente.email }}</p>
                </div>
            </div>

            <ul class="nav-menu">
                <li><a href="#" ><i>üìã</i> I Miei Ordini</a></li>
                <li><a href="#"><i>üè†</i> Indirizzi</a></li>
                <li><a href="#"><i>üë§</i> Dati Personali</a></li>
                <li><a href="{% url 'ecommerce:logout' %}" class="active"><i>üì§</i> Logout</a></li>
            </ul>
        </div>
        <div class="content-area">
            <!--<div class="content-header">
                <h2 class="content-title">I Miei Ordini</h2>
                </div>

            <table class="orders-table">
                </table>-->
        </div>
    </div>
</main>
<script>
   // Script per la gestione degli ordini
    document.addEventListener('DOMContentLoaded', function() {
    // Nascondi tutti i dettagli all'inizio
    document.querySelectorAll('.order-detail').forEach(detail => {
        const detailRow = detail.closest('tr');
        if (detailRow) {
            detailRow.style.display = 'none';
        }
    });
    
    // Gestisci filtri
    setupFilters();
});

/**
 * Toggle visibilit√† dettagli ordine
 */
function toggleOrderDetail(orderId) {
    // Ottieni la riga dell'ordine
    const orderRow = document.querySelector(`tr[data-order-id="${orderId}"]`);
    if (!orderRow) return;
    
    // Ottieni la riga dei dettagli (quella successiva)
    const detailRow = orderRow.nextElementSibling;
    if (!detailRow || !detailRow.querySelector(`#detail-${orderId}`)) return;
    
    // Alterna la visibilit√†
    const isVisible = detailRow.style.display === 'table-row';
    
    // Prima chiudi tutti i dettagli
    document.querySelectorAll('.order-detail').forEach(detail => {
        const row = detail.closest('tr');
        if (row) {
            row.style.display = 'none';
        }
        detail.classList.remove('active');
    });
    
    // Se era nascosto, mostralo
    if (!isVisible) {
        detailRow.style.display = 'table-row';
        const detailElement = document.getElementById(`detail-${orderId}`);
        if (detailElement) {
            detailElement.classList.add('active');
        }
    }
}

/**
 * Configura i filtri per la tabella degli ordini
 */
function setupFilters() {
    const filterSelect = document.querySelector('.filter-select');
    const searchInput = document.querySelector('.search-input');
    const orderRows = document.querySelectorAll('.orders-table tbody tr[data-order-id]');
    
    if (filterSelect) {
        filterSelect.addEventListener('change', () => filterOrders(orderRows, filterSelect, searchInput));
    }
    
    if (searchInput) {
        searchInput.addEventListener('input', () => filterOrders(orderRows, filterSelect, searchInput));
    }
}

/**
 * Filtra le righe della tabella in base ai criteri
 */
function filterOrders(orderRows, filterSelect, searchInput) {
    const filterValue = filterSelect ? filterSelect.value : 'all';
    const searchValue = searchInput ? searchInput.value.toLowerCase() : '';
    
    // Nascondi tutti i dettagli prima
    document.querySelectorAll('.order-detail').forEach(detail => {
        const row = detail.closest('tr');
        if (row) {
            row.style.display = 'none';
        }
        detail.classList.remove('active');
    });
    
    // Applica i filtri alle righe degli ordini
    orderRows.forEach(row => {
        let showRow = true;
        
        // Filtra per stato
        if (filterValue !== 'all') {
            const statusElement = row.querySelector('.status-badge');
            if (statusElement) {
                const hasStatus = statusElement.classList.contains('status-' + filterValue);
                if (!hasStatus) {
                    showRow = false;
                }
            }
        }
        
        // Filtra per testo di ricerca
        if (searchValue !== '') {
            const rowText = row.textContent.toLowerCase();
            if (!rowText.includes(searchValue)) {
                showRow = false;
            }
        }
        
        // Mostra o nascondi la riga
        row.style.display = showRow ? '' : 'none';
    });
}
</script>
{% endblock content %}